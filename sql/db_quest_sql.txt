-- CREATE DATABASE db_quest;
USE db_quest;

CREATE TABLE user (
	id   int         NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name varchar(50) NOT NULL UNIQUE
);

CREATE TABLE session (
	id        int  NOT NULL PRIMARY KEY AUTO_INCREMENT,
	prompt    text NOT NULL,
	narrative text NOT NULL,
	userId    int  NOT NULL,
	FOREIGN KEY (userId) REFERENCES user (id) ON DELETE CASCADE
);

CREATE TABLE scene (
	id        int NOT NULL PRIMARY KEY AUTO_INCREMENT,
	sessionId int NOT NULL,
	FOREIGN KEY (sessionId) REFERENCES session (id) ON DELETE CASCADE
);

CREATE TABLE card (
	id              int         NOT NULL AUTO_INCREMENT PRIMARY KEY,
	cardType        varchar(50) NOT NULL,
	cardName        varchar(50) NOT NULL,
	cardScore       int         NOT NULL,
	cardDescription TEXT
);

CREATE TABLE sceneCard (
	sceneId int NOT NULL,
	cardId  int NOT NULL,
	FOREIGN KEY (cardId) REFERENCES card (id) ON DELETE CASCADE,
	FOREIGN KEY (sceneId) REFERENCES scene (id) ON DELETE CASCADE
);

CREATE TABLE tag (
	id      int         NOT NULL PRIMARY KEY AUTO_INCREMENT,
	tagName varchar(50) NOT NULL
);

CREATE TABLE sessionTag (
	sessionId int NOT NULL,
	tagId     int NOT NULL,
	FOREIGN KEY (tagId) REFERENCES tag (id) ON DELETE CASCADE,
	FOREIGN KEY (sessionId) REFERENCES session (id) ON DELETE CASCADE
);

INSERT INTO user(name)
VALUES ("Caspar"),
			 ("Morin");

INSERT INTO session(prompt, narrative, userId)
VALUES ("Du är ute i en öknen och allt du ser är en död dromedar 25 meter bort", "", 1),
			 ("Det är storm ute på havs, regnkläderna är så gott som meningslösa. Du hör en plötslig smäll..", "", 2);

INSERT INTO scene(sessionId)
VALUES (1),
			 (2);

INSERT INTO card(cardType, cardName, cardScore, cardDescription)
VALUES ("problem", "Våg", 6, "En kraftig våg närmar sig skutan."),
			 ("aid", "Badring", 3, "Denna kom in händigt, frågan är om det räcker.."),
			 ("solution", "Våtdräkt", 9, "Skönt håller mig åtminstone torr!"),
			 ("problem", "Ank svärm", 13, "Yttrar sig på långt håll, hinner jag hitta en lösning?")

INSERT INTO sceneCard(sceneId, cardId)
VALUES (2, 1),
			 (2, 2),
			 (2, 3),
			 (2, 4);

INSERT INTO tag(tagName)
VALUES ("Ocean"),
			 ("Desert");

INSERT INTO sessionTag(sessionId, tagId)
VALUES (1, 2),
			 (2, 1);


SELECT *
FROM card
WHERE id = 1;

/*
drop table sessionTag
drop table tag
drop table sceneCard
drop table card
drop table scene
drop table session
drop table user
*/
